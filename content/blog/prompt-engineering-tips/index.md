---
title: プロンプトエンジニアリングのコツ
date: "2023-05-06"
category: "プログラミング"
tags: ["LLMs","ChatGPT"]
slug: /articles/prompt-engineering-tips/
---


# プロンプトエンジニアリングとは
プロンプトエンジニアリングとは、ChatGPTのような言語モデルから最適な回答を引き出すためのプロンプトを設計する学問分野である。この記事では基本的なプロンプトエンジニアリングの使い方のコツを扱う。より詳細な内容については「[Prompt Engineering Guide](https://www.promptingguide.ai/jp)」を参照されたい。なお、この記事の内容については、ChatGPT(GPT-3.5)で動作確認を実施した。

# ChatGPTについて
ChatGPTは、OpenAIによって開発された大規模言語モデルです。文章生成、テキスト分類、質問応答、文章の要約、情報抽出、言語翻訳など、さまざまなタスクに利用できる。

## 料金
ChatGPTでは、Webサイトから利用できるサービスとAPIから利用するサービスが完全に分かれていて、それぞれ以下のような料金体系になっている。

||Web|API|
|---|---|---|
|GPT-3.5|無料|従量課金（$0.002/1kトークン）|
|GPT-4|定額（$20/月）|従量課金（$0.03/1kトークン）|

ChatGPTの登録時に、APIが無料で使える18ドル分のチケットが付与されるので、「APIは無料で使える」と勘違いされがちだが、18ドル分使用後、あるいは一定期間経過後に利用できなくなる。

APIを利用する場合は、従量課金なので課金額の上限を設定しておくとよい。

## トークン
英語の場合、文字数に関わらずほぼ１単語１トークンだが、日本語の場合、ほぼ１文字１トークン、特に漢字は１文字２～３トークンかかる。会話履歴を含めてデータが送信されるため、会話を何往復も続けるような使い方には注意が必要である。


# パラメータの設定
パラメータを設定を変更すると、異なる回答が得られるようになる。

|パラメータ|説明|
|---|---|
|Temperature|モデルが応答を生成する際の決定性を表すパラメータ。この値が低いほどより決定論的になり、高くなるほどランダム性が増す。QAなどの正確性が求められるタスクではこの値を低く、詩の生成などの創造性が求められるタスクでは高く設定すると効果的である。|
|Top_p|Temperatureと同様にモデルが応答を生成する際の決定性を表すパラメータ。|

一般的には、上記のどちらか一方を変更すれば良い。なお、これらのパラメータは、ChatGPTのAPIでは変更できるが、ChatGPTのサイトでは変更できない。


# 簡単に始める
プロンプトの設計は最適な回答を得るために多くの試行錯誤が必要な反復的なプロセスである。シンプルなプロンプトから始めて、徐々に要素や文脈を追加していくのが良い。

# 良いプロンプト
## 指示を明確にする
「書く」、「分類する」、「要約する」、「翻訳する」、「並べ替える」、「コードを生成する」など、達成したいことを明確に指示することで、効果的なプロンプトを設計できる。一般的に指示はプロンプトの最初に記述する。

```text:title=プロンプト
以下の文章をドイツ語に翻訳してください。

入力：私はドイツ語を勉強しています。
翻訳：
```

```text:title=出力
Ich lerne Deutsch.
```


## 直接的、具体的に記述する
あいまいな表現を避け、直接的、具体的に記述することで、効果的なプロンプトを設計できる。

```text:title=プロンプト(元)
プロンプトエンジニアリングの説明を、短く、数文で、ざっくり説明してください。
```

```text:title=プロンプト(改良後)
中学生にもわかるように、プロンプトエンジニアリングを2～3文で説明してください。
```


## 文脈を追加する
文脈として、役職を与えたり、制限、前提、予備知識を追加することで、効果的なプロンプトを設計できる。

```text:title=プロンプト(役職を与える)
あなたは優秀な物理学者です。
小学生にもわかるように、万有引力について説明してください。
```


```text:title=出力
はい、分かりやすく説明しますね。

万有引力とは、全ての物体には引力という力が働いており、その強さは物体の質量と距離によって決まる力です。例えば、地球の重力は私たちを引きつけ、私たちは地球に引かれています。同じように、月は地球の引力によって引き寄せられ、地球もまた月を引きつけます。

この引力は、ニュートンの万有引力の法則で表されます。この法則によれば、二つの物体間の引力は、それらの質量の積に比例し、それらの間の距離の2乗に反比例することが分かっています。

例えば、地球と月の間の引力は、地球と月の質量の積に比例し、地球と月の距離の2乗に反比例します。この法則によって、私たちは太陽系の惑星の動きや、銀河系の星々の動きなどを説明することができます。

ということで、万有引力とは、全ての物体が持っている引力のことであり、それは物体の質量と距離によって決まる力です。
```

```text:title=プロンプト(文字数制限、人物の予備知識を追加する)
AさんとBさんの会話を200文字程度で生成してください。

・Aさんは昨日のサッカーの試合で応援していたチームが勝ってテンションが高い。
・Bさんはサッカーにはあまり興味がない。
```

```text:title=出力
Aさん: 昨日のサッカーの試合、めっちゃ面白かった！うちのチームが勝ったんだ！
Bさん: へー、それはよかったね。
Aさん: ホントに最高だったよ！あの勝利は今シーズンで最高の瞬間だったと思う。
Bさん: 私はサッカーにはあまり興味がないけど、うれしい気持ちはわかるよ。
Aさん: ありがとう！今回の勝利は次の試合にもつながると思うんだ。もう次の試合が待ちきれない！
Bさん: そうなるといいね。私はあまり詳しくないけど、がんばってほしいよ。
```


## 出力のフォーマットを指定する
フォーマットを具体的に指定すると、特定の出力フォーマットで回答を得ることができる。

```text:title=プロンプト
以下の文章からサウスウェスト航空が創業された年を抽出してください。
望ましいフォーマット：
年： <year>
入力：サウスウェスト航空は、アメリカ合衆国の航空会社であり、世界最大のLCCの一つです。1971年にテキサス州で創業され、主にアメリカ国内を中心に路線網を持っています。サウスウェスト航空は、低価格と高品質のサービスを提供し、スタッフと乗客の笑顔を大切にしています。また、航空業界で先駆的な試みとして、創業時から「バッグチェック料金不要」という方針を取っています。現在は、アメリカ国内だけでなく、メキシコ、中央アメリカ、カリブ海にも就航しています。
```

```text:title=出力
年： 1971年
```


また、以下のように表形式を指定して出力することもできる。

```text:title=プロンプト
ノートPCとデスクトップPCの違いを表形式でまとめてください。
```

```text:title=出力
以下は、ノートPCとデスクトップPCの主な違いを比較した表です。

|比較項目|ノートPC|デスクトップPC|
|---|---|---|
|サイズとポータビリティ|小型で携帯可能
大型で搬送が難しい|
|電源|バッテリー駆動|AC電源駆動|
|CPUの性能|劣る場合がある|高性能|
|グラフィックス|統合型グラフィックスが多い|専用グラフィックスカードが使える|
|拡張性|限られる場合がある|外付けデバイスが多く使える|
|価格|高価|安価|

以上のように、ノートPCは携帯性に優れ、バッテリー駆動である反面、性能や拡張性が限定される場合があります。一方、デスクトップPCは高性能で拡張性に富みますが、大型で携帯が困難であり、AC電源が必要です。価格については、一般的にノートPCはデスクトップPCよりも高価です。
```


## 「しないこと」ではなく「すること」を記述する
「しないこと」ではなく「すること」を記述することで、表現がより具体的になり、効果的なプロンプトを設計できる。

```text:title=プロンプト(元)
以下は、顧客に映画を推薦するエージェントです。興味を尋ねないで、個人情報を尋ねないでください。
顧客：私の興味に基づいて映画をお勧めください。
エージェント：
```

```text:title=出力
はい、どのジャンルの映画をお探しですか？
```

```text:title=プロンプト(改良後)
以下は、顧客に映画を推薦するエージェントです。エージェントは、上位のグローバルトレンド映画から映画をお勧めする責任があります。ユーザーの好みを尋ねることを避け、個人情報を尋ねることを避ける必要があります。エージェントがおすすめ映画を持っていない場合は、「申し訳ありませんが、今日お勧めする映画が見つかりませんでした。」と返答する必要があります。
顧客：私の興味に基づいて映画をお勧めください。
エージェント：
```

```text:title=出力
申し訳ありませんが、私たちはユーザーの好みを尋ねることができません。上位のグローバルトレンド映画からお勧めすることができます。ただし、今日おすすめできる映画が見つからない場合があります。
```


# Zero-ShotとFew-Shot
## Zero-Shot
大量のデータでトレーニングされた大規模言語モデルは、追加の学習なし（ゼロショット）でも、ある程度精度の高い回答を得られる。前述のプロンプトはすべてZero-Shotプロンプティングである。以下に典型的なZero-Shotプロンプティングの例を示す。

```text:title=プロンプト
以下の文章をネガティブ、ポジティブに分類してください。
昨日行ったレストランの料理は美味しかった。
```

```text:title=出力
ポジティブ
```

## Few-Shot
ゼロショットでは十分な精度の回答が得られないときは、プロンプト内でデモ（フューショット）を提供することでより高精度の回答が得られる場合がある。以下に典型的なFew-Shotプロンプティングの例を示す。

```text:title=プロンプト
Q：素晴らしい。
A：ポジティブ
Q：このUIは酷い。
A：ネガティブ
Q：あの本は最高だった。
A：ポジティブ
Q：なんてひどい音楽だ。
A：
```

```text:title=出力
ネガティブ
```

QA方式ではなく//方式で記載しても同様の結果が得られる。

```text:title=プロンプト
素晴らしい。 // ポジティブ
このUIは酷い。 // ネガティブ
あの本は最高だった。 // ポジティブ
なんてひどい音楽だ。 //
```

```text:title=出力
ネガティブ
```


# その他のTips
## ステップバイステップでの回答
大規模言語モデルの学習には論文のような論理的な文章と話し言葉のような直感的な文章が両方使われている。推論系のタスクの場合、「ステップバイステップ」という条件を追加することで、論理的な文章を参考に思考の連鎖を促して、最適な回答を得られるようになる場合がある。

```text:title=プロンプト(元)
私はAさんからみかんを12個もらって、Bさんに3つ、Cさんに2つ渡しました。その後、Dさんに3つもらい、2つ食べました。残りは何個ですか？
```

```text:title=プロンプト(改良後)
私はAさんからみかんを12個もらって、Bさんに3つ、Cさんに2つ渡しました。その後、Dさんに3つもらい、2つ食べました。残りは何個ですか？ステップバイステップで考えてみましょう。
```

ただし、「ステップバイステップ」の魔法はChatGPTがリリースされる前のGPT-3時代に発見されたものであるため、バージョンが上がるに連れて「ステップバイステップ」という条件を追加しなくても十分に高精度の回答が得られるようになっていると予想される。著者がChatGPT(GPT-3.5)で動作確認した範囲では、「ステップバイステップ」という条件を追加しても優位な差はみられなかった。

## 情報なしという回答
大規模言語モデルでは、次の単語を予測して確率が高い単語を選び文章を生成しているだけなので、回答の中に間違った情報を含んでいる場合もある。情報がない場合は「情報がありません」と回答するように指定することで、最適な回答を得られるようになる場合がある。

```text:title=プロンプト(元)
枠単回帰とはなんですか？
```

```text:title=プロンプト(改良後)
Q：原子とはなんですか？
A：原子は身の回りのあらゆるものを構成する微小粒子で、原子核とその周りを回る電子から構成されています。
Q：縞々島とはなんですか？
A：情報がありません。
Q：太陽系には何個の惑星がありますか？
A：水星、金星、地球、火星、木星、土星、天王星、海王星の8個の惑星が存在します。
Q：合祀練度とはなんですか？
A：情報がありません。
Q：枠単回帰とはなんですか？
A：
```

こちらは、著者がChatGPT(GPT-3.5)で動作確認したが、うまく動作せず、嘘の回答が得られた。

## 回答が途中で切れる場合
回答が途中で切れた場合、「続き」や「go on」などと入力すると回答の続きが生成される。

```text:title=プロンプト
続き
``

```text:title=プロンプト
go on
```


## 変数と関数
変数や関数を定義して、使い回すことができる。また、for文も使用できる。

```text:title=プロンプト(変数の利用)
[テーマ]：意識

[テーマ]について100文字程度で説明してください。
```

```text:title=出力
[テーマ]：意識

[テーマ]について100文字程度で説明してください。
```

```text:title=プロンプト(関数の利用)
[説明]([テーマ]){
    [テーマ]について100文字程度で説明してください。
}

[説明]([テーマ]="メタ認知")を実行
```

```text:title=出力
メタ認知とは、自分自身の思考や学習についての認識や理解することを指します。つまり、自分が何を知っているか、何を知らないか、どのように学ぶかなどを意識することです。メタ認知能力が高い人は、自己評価や問題解決能力、学習効果の向上などにつながるとされています。
```

```text:title=プロンプト(for文の利用)
for i in ["テロ","お菓子","人間"]:
    [説明]([テーマ]=i)
```

```text:title=出力
説明：
テロとは、政治的・宗教的・思想的な目的に基づき、暴力や破壊行為を行うことで、社会や政府に対する脅威を与える行為を指します。

説明：
お菓子は、主に甘い味や香りが楽しめる食品のことを指します。菓子類には、ケーキ、クッキー、キャンディ、チョコレートなどがあります。

説明：
人間とは、哺乳動物の一種で、自己意識や思考力、言語能力、文化や社会を形成する能力などを持つ動物のことを指します。現在、世界には70億人以上の人間が存在しています。
```

# 参考資料
+ [Prompt Engineering Guide](https://www.promptingguide.ai/jp)
+ [ChatGPT APIを使う前に知っておきたい前提知識](https://pouhon.net/chatgpt-api/7694/)
+ [架空パラメーターによるChatGPTの文章表現の操作](https://note.com/it_navi/n/n3d64d1a0b6eb)

